"use strict";define(["module","common/kernel/kernel","common/pointerevents/pointerevents","./lang"],function(e,t,a,r){var l,u,f,v,n,h,g,o,i,s,p,c,y,d,C=document.createElement("div"),b=32,T="margin-top 100ms ease-in-out",E=new MutationObserver(function(e){for(var t=0;t<e.length;t++)"attributes"===e[t].type&&("data-value"===e[t].attributeName||"data-options"===e[t].attributeName||"data-required"===e[t].attributeName?q(e[t].target):"data-placeholder"!==e[t].attributeName||e[t].target.dataset.value||(e[t].target.dataset.firstChild.data=e[t].target.dataset.placeholder||r.choose))}),M={init:function(e){e.addEventListener("click",O),q(e),E.observe(e,{attributes:!0,attributeFilter:["data-value","data-options","data-placeholder"]})},action:k};return C.innerHTML='<div class="title">--</div><div class="content"></div><div class="btns"><a class="clear">--</a><a class="ok">--</a></div>',h=C.querySelector(".title").firstChild,g=C.querySelector(".content"),o=C.querySelector(".ok"),i=C.querySelector(".clear"),t.appendCss(require.toUrl(e.id)),g.addEventListener("transitionend",function(e){n.length<u?e.target.style.transition="":e.target.style.marginTop?e.target.remove():(e.target.style.transition="",this.lastChild.remove())}),o.addEventListener("click",function(){t.closeDialog("ok")}),i.addEventListener("click",function(){t.closeDialog("clear")}),a(g,function(e){if(n.length>1)if("start"===e.type){if(!this.pointers.length)return e.domEvent.preventDefault(),n.length<u?d=g.firstChild.offsetTop:(y=p,d=0),s=e.y,!0}else if("move"===e.type){var t=e.y-s;n.length<u?g.firstChild.style.marginTop=Math.min(Math.max(0,d+t),b)+"px":((d=t%b)>0&&(d-=b),(y=(p-Math.floor(t/b))%n.length)<0&&(y+=n.length),g.innerHTML=N(y,d))}else n.length<u?((d=g.firstChild.offsetTop)%b&&(d=Math.round(d/b),m()),p=0===d?1:0):d?(m(),p=(y-1-Math.round(d/b)+n.length)%n.length):p=y}),M;function m(){g.firstChild.style.marginTop=-d>b/2?-b+"px":"",g.firstChild.style.transition=T}function q(e){if(e.dataset.options){var t=JSON.parse(e.dataset.options);if("Array"===dataType(t))t.indexOf(e.dataset.value)<0?e.dataset.required&&t.length?e.firstChild.data=e.dataset.value=t[0]:L(e):e.firstChild.data=e.dataset.value;else if(t.hasOwnProperty(e.dataset.value))e.firstChild.data=t[e.dataset.value];else{var a=Object.keys(t);e.dataset.required&&a.length?(e.dataset.value=a[0],e.firstChild.data=t[a[0]]):L(e)}}}function L(e){e.dataset.value&&(e.dataset.value=""),e.firstChild.data=e.dataset.placeholder||r.choose}function O(){!this.classList.contains("disabled")&&this.dataset.options&&k.call(this)}function k(e){var a=this;t.htmlDialog(C,"selectDialog",D,function(){if(a!==M&&a?(f=(l=a).dataset,v=JSON.parse(f.options)):(l=void 0,v=(f=e).options),"Array"===dataType(v)){n=v,v={},p=0;for(var s=0;s<n.length;s++)v[n[s]]=n[s],f.value===n[s]&&(p=s)}else n=Object.keys(v),(p=n.indexOf(f.value))<0&&(p=0);if(u=n.length>8?9:n.length>6?7:n.length>4?5:n.length?3:0){if(c=(u-1)/2,g.style.height=u*b+2+"px",n.length<u){for(var y="",d=0;d<n.length;d++)y+=`<div>${v[n[d]]}</div>`;g.innerHTML=y,0===p&&(g.firstChild.style.marginTop=b+"px")}else g.innerHTML=N(p);h.data=f.title||f.placeholder||r.choose,o.firstChild.data=f.ok||r.ok,i.firstChild.data=f.clear||r.clear,i.style.display=f.required||!f.value||1===n.length?"none":""}else t.closeDialog()})}function D(e){var t;e&&("ok"===e&&f.value!==n[p]?(t=!0,f.value=n[p]):"clear"===e&&""!==f.value&&(t=!0,f.value=""),l?(t&&l.dispatchEvent(new Event("change")),l.dispatchEvent(new Event(e))):(t&&"function"==typeof f.onchange&&f.onchange({type:"change"}),"function"==typeof f["on"+e]&&f["on"+e]({type:e})))}function N(e,t){var a,r;t?(n.length>u?(r=e-c-1)<0&&(r+=n.length):r=(e+c)%n.length,a=`<div style="margin-top:${t}px">${v[n[r]]}</div>`):a="";for(var l=e-c;l<=e+c;l++){var f=l%n.length;f<0&&(f+=n.length),a+=`<div>${v[n[f]]}</div>`}return a}});